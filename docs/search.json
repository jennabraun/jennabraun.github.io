[
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "jennabraun.github.io",
    "section": "",
    "text": "R Stats and GIS\nQuantitative Analyses\nCommunity Ecology\nPlant-insect Interaction\n\n\n\n\n\nPhD. candidate, Biology, York University (current)\nMSc in Biology, 2018, York University\nHBSc in Biology and Environmental Science, minor in Geographic Information Systems, 2016\nMcMaster University"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "myblog",
    "section": "",
    "text": "analysis\n\n\nR\n\n\necology\n\n\ndata wrangling\n\n\n\n\nTutorial in R for formatting data for analysis in the vegan package\n\n\n\n\n\n\nOct 4, 2019\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/2019/index.html",
    "href": "posts/2019/index.html",
    "title": "Diversity data wrangling for the vegan package",
    "section": "",
    "text": "For new users, its functionality can be daunting because many functions require two, very differently formatted dataframes as input. The first is a community data matrix in a wide format. For demonstration, I will be using a dataset of ant morphospecies abundances from Californian arid ecosystems that I collected during a three-week survey Spring 2019.\n\nlibrary(tidyverse)\nlibrary(vegan)\nlibrary(DT)\nants <- read.csv(\"desertants.csv\")\n\n\nIntroduction\nThis is what the dataset looks like. It is in 'long' format, meaning each species and its abundance is in one row. A single sample can have multiple rows, one for each species. This is the format I use when working through sample vials IDing insects.\n\n\n\n\n\n\n\nVegan requires a wide format, where the species are columns and there is only one sample per row. In this case I need to clean the data first, and then converting it into a wide format is straightforward using tidyr.\n\nstr(ants)\n\n'data.frame':   357 obs. of  14 variables:\n $ X            : int  1 2 3 4 5 6 7 8 9 10 ...\n $ Region       : chr  \"Cuyama\" \"Cuyama\" \"Mojave\" \"Mojave\" ...\n $ Site         : chr  \"C2\" \"C1\" \"M3\" \"M1\" ...\n $ Microsite    : chr  \"shrub\" \"shrub\" \"ephedra\" \"larrea\" ...\n $ Rep          : int  26 2 2 2 18 22 26 29 6 6 ...\n $ location     : chr  \"ethanol\" \"ethanol\" \"ethanol\" \"pinned\" ...\n $ Quantity     : int  3 1 1 1 1 2 1 6 3 6 ...\n $ Order        : chr  \"Hymenoptera\" \"Hymenoptera\" \"Hymenoptera\" \"Hymenoptera\" ...\n $ Family       : chr  \"Formicidae\" \"Formicidae\" \"Formicidae\" \"Formicidae\" ...\n $ Subfamily    : chr  NA NA NA NA ...\n $ Genus        : chr  NA \"Pogonomyrmex\" NA NA ...\n $ Species      : logi  NA NA NA NA NA NA ...\n $ highest.rtu  : chr  \"alate\" \"alate\" \"alate\" \"alate\" ...\n $ morphospecies: chr  \"alate NA\" \"alate NA\" \"alate NA\" \"alate NA\" ...\n\n\n\n\nWrangle the species dataset\nMicrosite is the location the traps were placed. I can see from str(ants) that there are errors in the data because there should only be three microsites. Inputting data into excel often introduces invisible blank spaces\n\n#remove the blanks\nants$Microsite <- gsub(\" \", \"\", ants$Microsite)\n\n#replace all instances of the string 'shrub' with 'ephedra'\nants$Microsite <- gsub(\"shrub\", \"ephedra\", ants$Microsite)\n\n#convert to a factor\nants$Microsite <- as.factor(ants$Microsite)\n\nNext we need a unique sample identifier. I'm using site + microsite + rep.\n\nants$uniID <- paste(ants$Site, ants$Microsite, ants$Rep)\n\nDrop all columns except the sample identifier, species identity and abundance and spread the data.\n\nants <- ants %>% select(uniID, morphospecies, Quantity) \n\n#aggregrate observations for the same species \n#if there are multiple vials for the same rep\n\nants <- ants %>% group_by(uniID, morphospecies) %>% summarise(Quantity = sum(Quantity)) \n\n`summarise()` has grouped output by 'uniID'. You can override using the `.groups` argument.\n\n#spread data into wide format\n\ncomm <- ants %>% spread(morphospecies, Quantity)\n\n#drop the identifier and any unwanted species. \n#In this case I am excluding reproductive alates \n#because I couldn't assign them to morphospecies \n\ncomm <- ungroup(comm) %>% select(.,-\"alate NA\", -\"ignore NA\")\n\n#replace the NAs with zeros\ncomm[is.na(comm)] <- 0\n\nThis is what the data looks like in wide format: Sites are rows and species are columns.\n\n\n\n\n\n\n\n\n\n\n\nWrangle the environemental dataset\n\ncov <- read.csv(\"cov.csv\")\n\n\n\n\n\n\n\n\nIt has far more rows than the community dataset because it is part of a larger project. The column PF specifies if a pitfall trap was placed at that location.\n\n#first remove all the rows without pitfall traps\ncov <- filter(cov, PF == \"Y\")\n\n#create a unique identifier to match the community data row names\ncov$uniID <- paste(cov$site, cov$Microsite, cov$ID)\n\n\n\nDealing with sites with no species\nHow you proceed after this point depends on whether you have samples with zero specimens. This dataset has zeroes and most tutorials ignore that zeroes happen in real datasets.\nFirst, determine which pitfall samples had zero specimens using dplyr's antijoin()\n\n#put the covariate dataset first\nzeroes <- anti_join(cov, comm, by = \"uniID\")\nstr(zeroes)\n\n'data.frame':   15 obs. of  10 variables:\n $ Region   : chr  \"Panoche\" \"Panoche\" \"Panoche\" \"Panoche\" ...\n $ site     : chr  \"PAN3\" \"PAN2\" \"PAN2\" \"PAN1\" ...\n $ ID       : int  19 6 6 26 30 30 22 29 18 6 ...\n $ Microsite: chr  \"ephedra\" \"ephedra\" \"open\" \"open\" ...\n $ x        : int  280 225 NA NA 270 NA 220 375 160 370 ...\n $ y        : int  265 200 NA NA 260 NA 210 360 130 255 ...\n $ z        : int  115 80 NA NA 130 NA 145 185 70 130 ...\n $ rdm.cov  : int  50 65 8 15 45 35 30 35 8 6 ...\n $ PF       : chr  \"Y\" \"Y\" \"Y\" \"Y\" ...\n $ uniID    : chr  \"PAN3 ephedra 19\" \"PAN2 ephedra 6\" \"PAN2 open 6\" \"PAN1 open 26\" ...\n\n#15 observations had zero ants\n\nAdd the empty samples to the community dataframe and populate with zeroes\n\nzeroes <- select(zeroes, \"uniID\")\ncomm <- bind_rows(comm, zeroes)\ncomm[is.na(comm)] <- 0\n\nMatch the order of the two datasets\n\nall.equal(comm$uniID, cov$uniID)\n\n[1] \"Lengths (157, 156) differ (string compare on first 156)\"\n[2] \"156 string mismatches\"                                  \n\n#need to reorder them\ncomm <- comm[match(cov$uniID, comm$uniID),]\nall.equal(comm$uniID, cov$uniID)\n\n[1] TRUE\n\n\n\n#drop the unique identifier column from community dataframe\ncomm <- select(comm, -uniID)\n\n\n\nAlpha diversity calculations\nCalculate abundance, species richness,Shannon & Simpson's index, and evenness and bind these indices to the covariate dataframe for visualization and modelling\n\ncov$abundance <- apply(comm, 1, sum)\n#check that the total is what you expect\nsum(cov$abundance)\n\n[1] 3769\n\nH <- diversity(comm)\nsimp <- diversity(comm, \"simpson\")\nS <- specnumber(comm)\nJ <- H/log(S)\ncov$H <- H\ncov$Simpson <- simp\ncov$Species <- S\ncov$Even <- J\n\nDone!\n\nggplot(cov, aes(Microsite, Species)) + geom_boxplot() + ylab(\"Ant Species Richness\")\n\n\n\n\n\n\nRDA example\n\ncomm <- decostand(comm, \"hellinger\")\n\np1 <- rda(comm ~ cov$Microsite + cov$rdm.cov)\np1\n\nCall: rda(formula = comm ~ cov$Microsite + cov$rdm.cov)\n\n              Inertia Proportion Rank\nTotal         0.73008    1.00000     \nConstrained   0.08311    0.11383    3\nUnconstrained 0.64697    0.88617   23\nInertia is variance \n\nEigenvalues for constrained axes:\n   RDA1    RDA2    RDA3 \n0.07434 0.00572 0.00305 \n\nEigenvalues for unconstrained axes:\n    PC1     PC2     PC3     PC4     PC5     PC6     PC7     PC8 \n0.14910 0.12034 0.07951 0.05873 0.04364 0.03710 0.03314 0.02714 \n(Showing 8 of 23 unconstrained eigenvalues)\n\nanova.cca(p1)\n\nPermutation test for rda under reduced model\nPermutation: free\nNumber of permutations: 999\n\nModel: rda(formula = comm ~ cov$Microsite + cov$rdm.cov)\n          Df Variance      F Pr(>F)    \nModel      3  0.08311 6.5084  0.001 ***\nResidual 152  0.64697                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1"
  },
  {
    "objectID": "about.html#interests",
    "href": "about.html#interests",
    "title": "jennabraun.github.io",
    "section": "Interests",
    "text": "Interests\n\nData science in R\nGIS\nQuantitative Analyses\nCommunity Ecology\nPlant-insect Interactions"
  },
  {
    "objectID": "about.html#education",
    "href": "about.html#education",
    "title": "jennabraun.github.io",
    "section": "Education",
    "text": "Education\n\nPhD. candidate, Biology, York University (current)\nMSc in Biology, 2018, York University\nHBSc in Biology and Environmental Science, minor in Geographic Information Systems, 2016, McMaster University"
  }
]